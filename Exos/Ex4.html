<!DOCTYPE html>
<html>
  <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
        <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
        <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  </head>
  <body style="margin:0; overflow:hidden">
        <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
            <a-marker type="pattern" url='./pattern-Hiro_Arthur.patt' minConfidence="0.25" emitevents="true">
                <a-entity
                    class="interactable" 
                    position="0 0 0"
                    rotation="0 180 0"
                    scale="0.5 0.5 0.5"
                    animate-on-click=""
                    gltf-model="./Assets/TARDIS-1.5.5.glb"
                ></a-entity>
            </a-marker>
            <a-entity camera>
                <a-cursor cursor="rayOrigin: mouse" raycaster="objects: .interactable" fuse="false" material="shader: flat; opacity: 0.8">
                </a-cursor>
            </a-entity>
        </a-scene>
        <script>
            const marker = document.querySelector('a-marker');
            marker.addEventListener('markerFound', () => console.log('FOUND'));
            marker.addEventListener('markerLost',  () => console.log('LOST'));
            const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            AFRAME.registerComponent('animate-on-click', {

                init: function () {
                var el = this.el;
                var state = false;

                el.addEventListener('click', async function () {
                    if (!state) {
                        el.setAttribute('animation__rotate', "property: rotation; to: 0 540 0; dur: 2000; easing: linear; loop: true");
                        el.setAttribute('animation__updown', "property: position; dir: alternate; to: 0 .5 0; dur: 1000; easing: easeInOutSine; loop: true");
                        state = !state;
                    } else {
                        var rot = parseFloat(el.getAttribute('animation__rotate', null).to.split(' ')[1]);
                        if (rot > 360) 
                        { 
                            el.setAttribute('animation__rotate', "property: rotation; to: 0 540 0 ; dur: 500; easing: easeInOutQuad; loop: false");
                            el.setAttribute('animation__updown', "property: position; to: 0 0 0; dur: 500; easing: easeInOutQuad; loop: false");
                            await sleep(500);
                            el.setAttribute('animation__rotate', "property: rotation; to: 0 180 0 ; dur: 0; easing: easeInOutQuad; loop: false");
                        } 
                        else 
                        { 
                            el.setAttribute('animation__rotate', "property: rotation; to: 0 180 0 ; dur: 500; easing: easeInOutQuad; loop: false");
                            el.setAttribute('animation__updown', "property: position; to: 0 0 0; dur: 500; easing: easeInOutQuad; loop: false");
                            await sleep(500);
                        }
                        state = !state;
                    }
                });
                }
            });
        </script>
  </body>
</html>